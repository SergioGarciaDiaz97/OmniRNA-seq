# üß¨ OmniRNA-seq: High-Performance HPC Transcriptomics Pipeline

![Python](https://img.shields.io/badge/Python-3.10%2B-blue?logo=python&logoColor=white)
![R](https://img.shields.io/badge/R-4.3%2B-blue?logo=r&logoColor=white)
![License](https://img.shields.io/badge/License-MIT-green)
![HPC](https://img.shields.io/badge/HPC-SLURM%20Ready-orange)
![Container](https://img.shields.io/badge/Container-Apptainer-red)

OmniRNA-seq es un ecosistema bioinform√°tico integral para el an√°lisis automatizado y reproducible de datos de RNA‚Äëseq bulk en entornos HPC. Transforma lecturas crudas de secuenciaci√≥n en resultados biol√≥gicos interpretables y listos para publicaci√≥n, desacoplando la ingenier√≠a de datos (Python) del modelado estad√≠stico avanzado (R/Bioconductor) y del despliegue reproducible basado en contenedores Apptainer/Singularity.

El sistema es agn√≥stico al organismo, contando con soporte nativo y flujos de anotaci√≥n validados para una amplia gama de modelos biol√≥gicos, incluyendo *Homo sapiens*, *Mus musculus*, *Saccharomyces cerevisiae*, *Arabidopsis thaliana*, *Danio rerio*, *C. elegans* y *Drosophila melanogaster*.

---

## üìç √çndice
1. [Organizaci√≥n del Proyecto](#-1-organizaci√≥n-del-proyecto-separation-of-concerns)
2. [Modos de Ejecuci√≥n](#-2-modos-de-ejecuci√≥n-orquestaci√≥n-inteligente)
3. [Launcher Maestro](#-3-punto-de-entrada-launcher-maestro-rna_seq_lets_trysh)
4. [Dependencias y Contenedores](#-4-dependencias-y-entorno-de-ejecuci√≥n-contenedores)
5. [Configuraci√≥n JSON](#-5-centro-de-control-de-configuraci√≥n-json)
6. [Requisitos de Metadatos](#-6-requisitos-de-metadatos-metadata_archivos)
7. [Arquitectura del Sistema](#-7-arquitectura-del-sistema)
8. [Estructura Global de Resultados](#-8-estructura-global-de-resultados-output-tree)
9. [Autor√≠a y Colaboraciones](#-9-autor√≠a-impacto-y-colaboraci√≥n)

---

## v üìÇ 1. Organizaci√≥n del Proyecto (Separation of Concerns)

```text
OmniRNA-seq/
‚îú‚îÄ‚îÄ RNA_SEQ_LETS_TRY.sh        # Launcher maestro (HPC / SLURM)
‚îú‚îÄ‚îÄ JSON/                      # Configuraci√≥n del experimento (El Contrato)
‚îÇ   ‚îú‚îÄ‚îÄ arabidopsis_nasa.json
‚îÇ   ‚îî‚îÄ‚îÄ mouse_alzheimer.json
‚îú‚îÄ‚îÄ Metadata_Archivos/         # Archivos CSV de dise√±o experimental
‚îÇ   ‚îú‚îÄ‚îÄ metadata_nasa.csv
‚îÇ   ‚îî‚îÄ‚îÄ metadata_alzheimer.csv
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ PYTHON_CODES/          # Orquestaci√≥n y Data Engineering
‚îÇ       ‚îú‚îÄ‚îÄ main.py
‚îÇ       ‚îú‚îÄ‚îÄ experiment_profiler.py
‚îÇ       ‚îú‚îÄ‚îÄ data_conector.py
‚îÇ       ‚îî‚îÄ‚îÄ 01_pipeline_core.py
‚îú‚îÄ‚îÄ R_CODES/                   # Motor Estad√≠stico y Biol√≥gico
‚îÇ   ‚îú‚îÄ‚îÄ 01_EDA_QC.R
‚îÇ   ‚îú‚îÄ‚îÄ 02_Differential_expression.R
‚îÇ   ‚îú‚îÄ‚îÄ 03_Functional_analysis_viz.R
‚îÇ   ‚îî‚îÄ‚îÄ 04_Comprehensive_Report_Builder.R
‚îî‚îÄ‚îÄ logs/                      # Trazas de ejecuci√≥n SLURM
Flujo l√≥gico: Launcher ‚Üí Python (data engineering) ‚Üí R (estad√≠stica/biol√≥gica) ‚Üí PDFs publicablesv üöÄ 2. Modos de Ejecuci√≥n (Orquestaci√≥n Inteligente)El pipeline implementa una l√≥gica de decisi√≥n automatizada para determinar el flujo de trabajo √≥ptimo. Esta decisi√≥n se basa en la fuente de los datos (p√∫blicos vs. locales) y el formato de entrada (crudos vs. matriz), definido en el archivo de configuraci√≥n JSON. Existen los par√°metros (ver apartado 5 Centro de configuraci√≥n JSON) cleanup_only_fastq y retain_only_fastqc_and_bam para ahorrar espacio de almacenamiento en la memoria.2.1. üåç Modo Explorer (Recuperaci√≥n Automatizada de Repositorios)Caso de uso: Meta-an√°lisis y benchmarking utilizando datos p√∫blicos (GEO, ENA, SRA). Activaci√≥n: Se ejecuta suministrando un Project_ID (ej. PRJNA, SRP) como argumento.Flujo Completo (End-to-End Processing):Configuraci√≥n: "counting_method": "featurecounts".Descripci√≥n: El sistema interroga las APIs de ENA/SRA para recuperar autom√°ticamente los metadatos del dise√±o experimental y los archivos FASTQ crudos. Ejecuta el pipeline completo: control de calidad, alineamiento y cuantificaci√≥n.Flujo Acelerado (Direct Matrix Analysis - Public):Configuraci√≥n: "counting_method": "precomputed_csv" + URL remota.Descripci√≥n: Descarga la matriz de conteos procesada directamente desde el repositorio del autor. Omite el alineamiento para saltar inmediatamente al an√°lisis estad√≠stico y funcional.Sintaxis (Bash): sbatch RNA_SEQ_LETS_TRY.sh JSON/config.json PRJNAxxxx2.2. üíª Modo Local (Infraestructura Privada / On-Premise)Caso de uso: An√°lisis de datos propios del laboratorio o colaboraciones privadas, sin conexi√≥n a APIs externas. Activaci√≥n: Se ejecuta sin argumento de Project_ID. Como tutorial para el modo local hemos replicado este m√©todo partiendo de muestras fastq descargadas (ver secci√≥n en este GitHub en carpeta Modo local).Procesamiento de Crudos (Raw Data Workflow):Configuraci√≥n: "fastq_list_strategy": "manual" + Manifiesto de archivos.Descripci√≥n: Procesa archivos FASTQ alojados en el sistema de ficheros local. Utiliza un manifiesto de rutas (URI file://) para ingerir las muestras y ejecutar el alineamiento y conteo.Flujo Acelerado Local (Direct Matrix Analysis - Local):Configuraci√≥n: "counting_method": "precomputed_csv" + Ruta local al archivo.Descripci√≥n: Ingesta directa de una matriz de conteos (.csv) suministrada externamente o pre-calculada. Realiza un bypass de la etapa de computaci√≥n intensiva para ejecutar exclusivamente los m√≥dulos de estad√≠stica (DESeq2), enriquecimiento y generaci√≥n de reportes.Sintaxis (Bash): sbatch RNA_SEQ_LETS_TRY.sh JSON/config.jsonüõ°Ô∏è Resiliencia Autom√°tica: Gracias a su arquitectura modular, OmniRNA-seq es capaz de retomar ejecuciones interrumpidas. Si un job es cancelado por el cl√∫ster por exceder el tiempo de pared (walltime), basta con re-lanzar el comando original; el sistema detectar√° los pasos completados y los archivos v√°lidos, saltando directamente a la etapa pendiente.v üöÄ 3. Punto de entrada: Launcher maestro (RNA_SEQ_LETS_TRY.sh)Todo el flujo de trabajo se orquesta desde un √∫nico script Bash optimizado para SLURM, que act√∫a como interfaz entre el usuario y el cl√∫ster HPC:Gesti√≥n eficiente de vol√∫menes: Configuraci√≥n din√°mica de bind paths y directorios temporales sobre sistemas de archivos paralelos (p. ej. BeeGFS), minimizando cuellos de botella de I/O.Aislamiento y reproducibilidad: Ejecuci√≥n controlada de contenedores Apptainer, garantizando versiones consistentes de herramientas clave como STAR, HISAT2, StringTie y R-Bioconductor.Limpieza autom√°tica: Implementaci√≥n de exit traps para la eliminaci√≥n segura de archivos temporales, optimizando el uso de almacenamiento en infraestructuras compartidas.v üì¶ 4. Dependencias y Entorno de Ejecuci√≥n (Contenedores)Para garantizar la inmutabilidad y reproducibilidad absoluta del an√°lisis, OmniRNA-seq no depende de librer√≠as instaladas en el sistema anfitri√≥n. Todo el flujo de trabajo se ejecuta mediante im√°genes de contenedores Apptainer o Singularity, asegurando que el entorno de computaci√≥n sea id√©ntico independientemente del cl√∫ster donde se despliegue.En lo referente a las herramientas de procesamiento upstream, el pipeline orquesta autom√°ticamente im√°genes oficiales de nf-core y Biocontainers con versiones exactas definidas en el contrato actual ("Gold Standard"):Control de Calidad: FastQC v0.12.1 y MultiQC v1.29.Limpieza y Trimming: Trimmomatic v0.39.Alineamiento: STAR (v2.7.10a) y HISAT2 v2.2.1.Cuantificaci√≥n: Subread featureCounts v2.0.6 y StringTie v2.2.3.‚ö†Ô∏è Nota T√©cnica sobre Est√°ndares de Secuenciaci√≥n:Formato de Calidad: El pipeline est√° optimizado para datos de secuenciaci√≥n modernos (Illumina 1.8+). Se asume estrictamente una codificaci√≥n de calidad Phred+33. El uso de archivos FASTQ antiguos con codificaci√≥n Phred+64 requiere una conversi√≥n previa no incluida en este flujo.Estrategia de Trimming: Por dise√±o, el pipeline utiliza exclusivamente Trimmomatic debido a su robustez y trazabilidad en entornos cl√≠nicos/acad√©micos, no permitiendo la sustituci√≥n por otros limpiadores (ej. fastp o cutadapt) en la configuraci√≥n est√°ndar.Por otro lado, los m√≥dulos de an√°lisis diferencial y funcional se ejecutan dentro de un entorno estad√≠stico personalizado denominado r_custom_env.sif. Este contenedor integra un ecosistema completo de R/Bioconductor (v3.18) versionado.<details><summary><strong>üëá Click para ver el desglose detallado de las librer√≠as R en el SIF</strong></summary>El contenedor incluye las siguientes capas de software validadas:üèóÔ∏è Infraestructura y N√∫cleo Bioconductor (Vitales):Sin estos cimientos, el an√°lisis gen√≥mico no es posible.BiocManager (v1.30.23), BiocGenerics (v0.48.1)S4Vectors (v0.40.2), IRanges (v2.36.0), GenomicRanges (v1.54.1)SummarizedExperiment (v1.32.0), BiocParallel (v1.36.0)üß¨ Motor Bioinform√°tico (User Facing):DESeq2 (v1.42.1) ‚Äî Modelado estad√≠stico.clusterProfiler (v4.10.1) ‚Äî An√°lisis de enriquecimiento (ORA/GSEA).gprofiler2 (v0.2.3) ‚Äî Consultas API multi-fuente.pathview (v1.42.0) ‚Äî Proyecci√≥n en rutas KEGG.biomaRt (v2.58.2) ‚Äî Conexi√≥n con BioMart/Ensembl.argparse v2.2.3 ‚Äî Puente vital para la orquestaci√≥n con Python.üåç Organismos Soportados Nativamente (Anotaci√≥n Offline):üå± Arabidopsis thaliana (org.At.tair.db)üë§ Homo sapiens (org.Hs.eg.db)üê≠ Mus musculus (org.Mm.eg.db)üêÄ Rattus norvegicus (org.Rn.eg.db)üêü Danio rerio (org.Dr.eg.db)ü™∞ Drosophila melanogaster (org.Dm.eg.db)ü™± Caenorhabditis elegans (org.Ce.eg.db)üç∫ Saccharomyces cerevisiae (org.Sc.sgd.db)üêî Gallus gallus (org.Gg.eg.db)üê∏ Xenopus laevis (org.Xl.eg.db)üìä Suite de Visualizaci√≥n & Reportes:ggplot2 v3.5.0, ggrepel v0.9.5, pheatmap v1.0.12enrichplot v1.22.0, plotly v4.10.4rmarkdown v2.26 & knitr v1.46Nota: Lista completa de versiones disponible en el archivo requirements_R.txt del repositorio.</details>v ‚öôÔ∏è 5. Centro de control de configuraci√≥n (üìÅ JSON/)OmniRNA-seq sigue un enfoque de Arquitectura Basada en Contratos, donde los archivos JSON definen completamente el experimento. Vamos a tratar cada uno a continuaci√≥n:1. project_setup ‚Äì Infraestructura y metodolog√≠aDefine el esqueleto del flujo de trabajo:aligner: Selecci√≥n de motor de alineamiento; star, hisat2 o both para validaci√≥n cruzada, permitiendo identificar sesgos algor√≠tmicos en el mapeo de lecturas.counting_method: define si el an√°lisis parte de lecturas crudas (featureCounts) o de una matriz de conteo ya precalculada (precomputed_csv).quantification_options: M√≥dulo de inteligencia para la normalizaci√≥n de la expresi√≥n:run_for: Permite definir de forma granular qu√© m√©tricas de normalizaci√≥n calcular para cada alineador (tpm, fpkm). El sistema utiliza StringTie para calcular estos valores, corrigiendo el sesgo por longitud de gen y profundidad de secuenciaci√≥n.run_exploratory_analysis: Activa o desactiva la fase de Control de Calidad Estad√≠stico (EDA), ideal para detectar posibles comportamientos outliers en muestras.explore_on: Define sobre qu√© matriz normalizada se realizar√° el diagn√≥stico de calidad EDA.2. source_data ‚Äì Estrategias de ingesta de datosfastq_list_strategy: manual o automatic, en ambas se utilizar√°n las muestras indicadas en fastq_list_file. El automatic (API ENA) est√° pensado para descargar y emplear todas las muestras indicadas en la url la cual se gener√≥ previamente por data_conector.py, el modo manual est√° pensado para emplear solamente una lista URLs de las √∫nicas muestras que queremos analizar, para una mayor flexibilidad y agilidad, est√° deber√° realizarse por el usuario. N√≥tese que, si se quiere realizar un an√°lisis en modo local en lugar de explorer, siempre ser√° manual.genome_urls: Descarga autom√°tica y construcci√≥n din√°mica de genomas/anotaciones.3. tool_parameters: Rendimiento y rigor bioinform√°ticoEste m√≥dulo define la estrategia computacional y los criterios de calidad del dato.A. Estrategia Computacional (Rendimiento):Paralelizaci√≥n Inteligente (Throttling): Para evitar la saturaci√≥n de los sistemas de archivos paralelos (I/O thrashing), el pipeline procesa la ingesta y alineamiento en bloques concurrentes (ej. 4 muestras simult√°neas). Para ello se emplean los par√°metros threads, threads_per_sample, download_threads y max_parallel_samples. Maximiza el throughput sin exceder cuotas del cl√∫ster.Gesti√≥n del Ciclo de Vida (Storage Lifecycle): Limpieza as√≠ncrona a nivel de worker, mediante retain_only_fastqc_and_bam y cleanup_only_fastq. Para desactivarlos poner false:Clave JSONValorDescripci√≥n T√©cnicaretain_only_fastqc_and_bamTrueModo Ahorro M√°ximo: Tras generar el BAM, purga FASTQs (crudos y trimeados), archivos SAM y directorios temporales (_STARtmp). Protege los reportes FastQC y el BAM final. Realiza limpieza retroactiva en re-ejecuciones.cleanup_only_fastqTrueAhorro Intermedio: Elimina √∫nicamente los FASTQ crudos descomprimidos tras el paso de Trimming, manteniendo las lecturas trimeadas en disco.Zero-Noise Protection(Autom√°tico)Auditor√≠a de integridad pre-ejecuci√≥n: detecta y elimina archivos de 0 bytes de intentos fallidos previos, forzando una regeneraci√≥n limpia de los datos.Trimmomatic: Configuraci√≥n de la limpieza de lecturas. Define adaptadores que se eliminar√°n (adapter_fasta_url), leading/trailing definen el umbral de calidad m√≠nima para recortar bases en el inicio (5‚Äô) y el final (3‚Äô) de la lectura, si cae por debajo del valor se elimina la base, ventana deslizante de calidad (slidingwindow) y longitud m√≠nima (minlen) para descartar fragmentos degradados.STAR: Ajuste de precisi√≥n de alineamiento (sjdbOverhang). Este par√°metro se calibra seg√∫n la longitud de lectura (ReadLength - 1) para optimizar el mapeo en uniones de empalme (splice junctions).FeatureCounts: Especificaci√≥n de la topolog√≠a de la librer√≠a. Controla la especificidad de hebra (strand_specific: 0 para unstranded, 1 para forward o 2 para reversely stranded).Analysis_thresholds: Define los criterios de corte para considerar un gen como Expresado Diferencialmente (DEG). Se especifican el log2fc y padj, esto permite rexplorar los an√°lisis con gran flexibilidad cambiando solo estos par√°metros.4. deseq2_experiment ‚Äì Dise√±o experimentalEste m√≥dulo conecta la matriz de expresi√≥n con las variables biol√≥gicas del estudio:metadata_path: Ruta al archivo de dise√±o experimental. Este archivo es el que vincula cada archivo FASTQ con su grupo biol√≥gico.grouping_variable: Define qu√© columna de los metadatos se utilizar√° para la comparaci√≥n (ej. condition).design_formula: Especifica el modelo estad√≠stico empleado. El sistema soporta dise√±os complejos incluyendo factores de confusi√≥n o interacciones. Gran flexibilidad y capacidad de re exploraci√≥n.control_group: Define expl√≠citamente el nivel de referencia (baseline). Todos los c√°lculos de enriquecimiento y expresi√≥n se realizar√°n comparando el grupo tratamiento contra este grupo control.5. annotation ‚Äì Contexto Biol√≥gicoEste m√≥dulo gestiona la traducci√≥n de identificadores t√©cnicos en nombres de genes con significado biol√≥gico, permitiendo la interoperabilidad entre diferentes bases de datos.organism_db: Especifica el paquete de anotaci√≥n de Bioconductor que se cargar√° din√°micamente. Este motor es vital para asignar funciones de Gene Ontology (GO) y rutas KEGG a cada gen.key_type: Define el formato de entrada de los IDs en tu archivo de anotaci√≥n GTF. El pipeline utilizar√° esta clave como puente para obtener los Gene Symbols y Entrez IDs necesarios para los an√°lisis funcionales.strip_gene_version (true): Activa un pre-procesamiento de limpieza de identificadores. Los genomas de Ensembl a menudo a√±aden un n√∫mero de versi√≥n tras el ID (ej: FBgn0000001.2).Si es true: El sistema elimina el punto y el n√∫mero final (FBgn0000001), permitiendo un mapeo exacto contra las bases de datos de anotaci√≥n que no suelen incluir versiones de transcrito.6. container_images ‚Äì Reproducibilidad BinariaRutas de Im√°genes: Definici√≥n expl√≠cita de los contenedores Singularity/Apptainer (.sif, .img) para cada herramienta. Esto congela las versiones del software (STAR, R, Samtools), garantizando la inmutabilidad del entorno de ejecuci√≥n.7. scripts ‚Äì Orquestaci√≥n de Motores Anal√≠ticos (R)Este m√≥dulo act√∫a como el mapa de rutas del pipeline en R, definiendo la ubicaci√≥n exacta de los algoritmos que ejecutan el an√°lisis estad√≠stico y biol√≥gico. Permite desacoplar el motor de ejecuci√≥n de la l√≥gica de an√°lisis.r_exploratory_script_path: Ruta al script de Control de Calidad y EDA (01_EDA_QC.R).r_deseq2_script_path: Ubicaci√≥n del motor de expresi√≥n diferencial (02_Differential_expression.R).r_enrichment_plotter_script_path: Ruta del script encargado de la generaci√≥n de redes y visualizaciones complejas (03_Functional_analysis_viz.R).r_pdf_report_script_path: Define el constructor del informe final paginado (04_Comprehensive_Report_Builder.R).8. functional_analysis ‚Äì Inteligencia biol√≥gicaEste m√≥dulo constituye la capa de interpretaci√≥n de alto nivel, dise√±ada para transformar las listas de genes en narrativas mecan√≠sticas mediante el uso de algoritmos de enriquecimiento de √∫ltima generaci√≥n.Configuraci√≥n de Especie:gprofiler_organism_code: Identificador sem√°ntico para consultas en tiempo real a la API de g:Profiler, garantizando que las anotaciones de GO y Reactome est√©n actualizadas al d√≠a de la ejecuci√≥n.pathview_kegg_code: C√≥digo de tres letras compatible con la base de datos KEGG para el mapeo de rutas metab√≥licas.Dualidad Anal√≠tica (SEA vs. GSEA):run_sea_analysis (ORA): Ejecuta el An√°lisis de Sobre-representaci√≥n. Compara tu lista de genes significativos contra el "background" gen√≥mico mediante un test hipergeom√©trico. Es ideal para identificar procesos biol√≥gicos que est√°n "encendidos" o "apagados" de forma discreta.sea_ontologies (BP, MF, CC): Segmenta el an√°lisis en las tres ramas de Gene Ontology: Biological Process (procesos), Molecular Function (qu√≠mica) y Cellular Component (ubicaci√≥n).run_gsea_analysis: Activa el Gene Set Enrichment Analysis. A diferencia del SEA, este motor no usa cortes de significancia, sino que analiza el transcriptoma completo rankeado por su Fold Change. Permite detectar cambios sutiles pero coordinados en rutas completas que el an√°lisis est√°ndar podr√≠a ignorar.Rigor Estad√≠stico:kegg_padj_threshold / sea_padj_cutoff: Filtro estricto de significancia tras la correcci√≥n por m√∫ltiples test (FDR), asegurando que las rutas reportadas tengan una base estad√≠stica s√≥lida.sea_qvalue_cutoff: Control adicional de la tasa de falsos positivos, vital en estudios con alta densidad de datos.Visualizaci√≥n Avanzada y Reportes:run_enrichment_plots: Automatiza la creaci√≥n de una suite de gr√°ficos biol√≥gicos:top_n_emap: Genera N (valor especificado, total flexibilidad) Enrichment Maps para visualizar la redundancia y conectividad entre t√©rminos de GO, agrup√°ndolos por similitud.top_n_cnet: Crea N Gene-Concept Networks, vinculando los genes m√°s significativos con sus respectivas rutas biol√≥gicas.top_n_ridge: Produce N Ridgeplots que muestran la distribuci√≥n de la frecuencia de cambio (NES) para las rutas principales.top_n_gseaplot: Genera los perfiles de enriquecimiento cl√°sicos para las N rutas con mayor impacto biol√≥gico.Pathview_kegg_code: Indicador del organismo para pathview. Proyecta los datos de expresi√≥n sobre mapas metab√≥licos oficiales. El sistema renderiza archivos donde cada enzima se colorea seg√∫n su regulaci√≥n (UP/DOWN), permitiendo interpretar visualmente el flujo metab√≥lico del organismo.run_final_pdf_reports: Ejecuta g:Profiler (multifuente GO/KEGG/REAC) + compila PDF paginado completo (TOC + Volcano + tablas coloreadas). 04_Comprehensive_Report_Builder.R.v üìÑ 6. Requisitos de Metadatos (Metadata_Archivos/)Para que el motor estad√≠stico DESeq2 interprete correctamente el dise√±o experimental, se requiere un archivo metadata.csv est√°ndar correspondiente al an√°lisis ubicado en la carpeta Metadata_Archivos/ (y referenciado en el JSON). Este archivo act√∫a como la llave maestra que conecta los archivos crudos con las variables biol√≥gicas.Reglas de Formato:Primera Columna: Debe contener los IDs de las muestras (coincidentes con los nombres de los archivos FASTQ/BAM).Columnas de Factores: Variables biol√≥gicas (ej. Genotipo, Tratamiento, Tiempo).Consistencia: Los nombres de las columnas deben coincidir con los t√©rminos usados en la design_formula del JSON.Nota T√©cnica: El pipeline incluye un m√≥dulo de sanitizaci√≥n autom√°tica (metadata_corregido.csv) que detecta y corrige caracteres en los nombres de las muestras (ej. reemplaza guiones - por puntos .) para asegurar la compatibilidad con R.v üèóÔ∏è 7. Arquitectura del sistema1. Ingenier√≠a de datos y orquestaci√≥n (Python 3.10+)La capa de ingenier√≠a act√∫a como el sistema nervioso del pipeline, gestionando la log√≠stica de datos antes de cualquier an√°lisis estad√≠stico, y se encuentra modularizada en cuatro componentes clave dise√±ados bajo el principio de responsabilidad √∫nica. El punto de entrada es main.py, que funciona como el director de orquesta; este script se encarga de procesar el archivo JSON de configuraci√≥n, validar las rutas del sistema y decidir la estrategia de ejecuci√≥n global, delegando las tareas a los subm√≥dulos correspondientes.La inteligencia de metadatos reside en experiment_profiler.py, el cual se conecta autom√°ticamente a las APIs p√∫blicas de ENA y Ensembl para recuperar los metadatos experimentales y construir din√°micamente las URLs de referencia para genomas y anotaciones. La log√≠stica de ingesta es manejada por data_conector.py, que gestiona la descarga paralela y robusta de archivos FASTQ, implementando l√≥gica de reintentos y validaci√≥n de integridad. Finalmente, 01_pipeline_core.py act√∫a como el motor de procesamiento que orquesta la ejecuci√≥n secuencial de herramientas externas cr√≠ticas (Trimmomatic, STAR, HISAT2, StringTie). Una caracter√≠stica distintiva es su capacidad de validaci√≥n cruzada: si se selecciona la opci√≥n "both", ejecuta ambos alineadores y genera archivos de intersecci√≥n para evaluar la consistencia t√©cnica, indicando que genes se han encontrado en ambos alineadores y cu√°les solo en cada uno, unificando finalmente todas las m√©tricas de calidad en un informe interactivo de MultiQC.2. Suite estad√≠stica y biol√≥gica (R / Bioconductor)El m√≥dulo 01_EDA_QC.R establece la l√≠nea base de calidad aplicando una transformaci√≥n log2(x+1) para estabilizar la varianza. Ejecuta un diagn√≥stico visual completo mediante seis visualizaciones clave, destacando su enfoque en la exploraci√≥n multidimensional y la auditor√≠a adaptativa:PCA Multidimensional Secuencial: No se limita al plano principal. El script descompone la estructura de los datos analizando la varianza explicada de los primeros 10 componentes principales y genera proyecciones espaciales iterativas (PC1 vs PC2, PC2 vs PC3, PC3 vs PC4, y PC4 vs PC5) para detectar agrupamientos sutiles o efectos de lote (batch effects) ocultos en dimensiones inferiores.Clustering Jer√°rquico Especificado: Construye los dendrogramas bas√°ndose en una matriz de distancias Euclidianas (dist()) y utiliza el m√©todo de aglomeraci√≥n por Complete Linkage (hclust(..., method="complete")) para maximizar la disimilitud entre cl√∫steres al fusionarlos.Su caracter√≠stica m√°s innovadora es un algoritmo heur√≠stico adaptativo para la auditor√≠a de calidad. Este sistema genera una sugerencia diagn√≥stica mediante un informe de texto automatizado con sem√°foros, adaptando sus matem√°ticas al tama√±o del grupo (N):Enfoque Cl√°sico (N < 5): Usa Media y Desviaci√≥n Est√°ndar (SD). Alerta si la distancia > 1.5 SD; Fallo si > 2.0 SD.Enfoque Robusto (N >= 5): Usa Mediana y MAD. Alerta si la distancia > 2.5 MAD; Fallo si > 3.0 MAD.Adem√°s, realiza un an√°lisis de variabilidad seleccionando los 50 genes m√°s variables y mapeando sus IDs a Gene Symbols autom√°ticamente. Por √∫ltimo, calcula las distancias biol√≥gicas euclidianas entre los centroides de los grupos para cuantificar la separaci√≥n experimental global.El motor estad√≠stico reside en 02_Differential_expression.R. Este script implementa Modelos Lineales Generalizados (GLM) mediante DESeq2, soportando dise√±os experimentales complejos con t√©rminos de interacci√≥n y aplicando la correcci√≥n de Benjamini-Hochberg (FDR). Antes del modelado, ejecuta una auditor√≠a exhaustiva de los conteos crudos, generando histogramas y boxplots logar√≠tmicos para evaluar la profundidad de secuenciaci√≥n y la homogeneidad entre r√©plicas biol√≥gicas, permitiendo detectar muestras fallidas o outliers t√©cnicos de forma temprana.Una vez validada la calidad, el m√≥dulo produce visualizaciones clave como MA Plots para verificar la normalizaci√≥n y Heatmaps de los genes m√°s significativos. Su caracter√≠stica m√°s destacada es la generaci√≥n de un Volcano Plot interactivo en formato HTML autocontenido, que permite la exploraci√≥n profunda de los datos point-and-click. Adem√°s, incluye un innovador m√≥dulo de descubrimiento de "Genes Hu√©rfanos" mediante sustracci√≥n de conjuntos para identificar genes estad√≠sticamente vitales sin ruta funcional conocida, y aplica un sistema de "reparaci√≥n de anotaciones" que asegura el mapeo correcto de metadatos incluso en organismos no modelo.El m√≥dulo 03_Functional_analysis_viz.R utiliza el motor estad√≠stico de clusterProfiler para transformar las listas de genes en una narrativa visual integral. Este componente aplica una dualidad anal√≠tica avanzada que ejecuta de forma paralela el an√°lisis de sobre-representaci√≥n (SEA) y el an√°lisis de enriquecimiento de conjuntos de genes (GSEA) sobre el transcriptoma completo rankeado. Para garantizar el rigor cient√≠fico, el sistema implementa la correcci√≥n de Benjamini-Hochberg (FDR) en todos los c√°lculos, controlando la tasa de falsos positivos derivada de las comparaciones m√∫ltiples. Su punto fuerte reside en la integraci√≥n metab√≥lica directa mediante Pathview, la cual mapea en archivos PNG nativos la expresi√≥n diferencial sobre diagramas oficiales de KEGG, coloreando los nodos seg√∫n su regulaci√≥n (Rojo=UP, Verde=DOWN) para visualizar el flujo metab√≥lico alterado.Adem√°s, se compilan todos los hallazgos en un Dashboard Interactivo unificado que permite filtrar din√°micamente las ontolog√≠as y realizar una exploraci√≥n point-and-click de los genes para observar sus m√©tricas inmediatamente, integrando expl√≠citamente los valores num√©ricos de NES y p-valor ajustado junto a cada t√©rmino para una interpretaci√≥n precisa. Complementariamente, se generan visualizaciones avanzadas como Dotplots, CnetPlots, EmapPlots y RidgePlots optimizados, que presentan la distribuci√≥n de densidad coloreada din√°micamente por NES, junto con un algoritmo exclusivo para la identificaci√≥n de "Genes Conectores" que act√∫an como puentes moleculares entre diferentes procesos biol√≥gicos.Finalmente, 04_Comprehensive_Report_Builder.R act√∫a como el editor final del pipeline. Utiliza la potencia de g:Profiler (r√©plica de https://biit.cs.ut.ee/gprofiler/gost) para realizar consultas multifuente en tiempo real, garantizando anotaciones siempre actualizadas en genes significativos. Implementa una arquitectura de renderizado de doble pase que pre-escanea los datos para calcular una paginaci√≥n perfecta antes de generar el documento final. Este m√≥dulo realiza una auditor√≠a de cobertura funcional para cuantificar el total de genes hu√©rfanos, y genera Volcano Plots contextuales sectorizados por ontolog√≠a, fusionando resultados de cinco bases de datos distintas (GO:BP, GO:MF, GO:CC, KEGG, Reactome) en una narrativa lineal coherente, estrictamente jerarquizada por significancia estad√≠stica (p < 10^-16).v üìÇ 8. Estructura Global de Resultados (Output Tree)Una vez finalizado el pipeline, los resultados se organizan autom√°ticamente en la siguiente jerarqu√≠a:Plaintext<PROJECT_DIR>/
‚îú‚îÄ‚îÄ <PROJECT_ID>_fastq_urls.txt                  # [Gen: data_conector.py]
‚îú‚îÄ‚îÄ Info_<PROJECT_ID>/                           # [Gen: experiment_profiler.py] No en modo local
‚îÇ   ‚îú‚îÄ‚îÄ info_experiment_<ID>.txt                # (Metadatos del dise√±o experimental) No en modo local
‚îÇ   ‚îî‚îÄ‚îÄ list_of_samples_<ID>.txt                 # (Tabla GSM | SRR | T√≠tulo)
‚îú‚îÄ‚îÄ adapters/                                    # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ TruSeq_adapters.fa
‚îÇ
‚îú‚îÄ‚îÄ REFERENCE_GENOMES_FILES/                     # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îú‚îÄ‚îÄ <Organism>.dna.toplevel.fa              # (Descargado de Ensembl)
‚îÇ   ‚îú‚îÄ‚îÄ <Organism>.<Version>.gtf                 # (Anotaci√≥n)
‚îÇ   ‚îî‚îÄ‚îÄ [Indices de STAR / HISAT2]               # (Generados por los alineadores)
‚îÇ
‚îú‚îÄ‚îÄ FASTQ_FILES/                                 # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ <SAMPLE>_1.fastq.gz                      # (Descarga raw)
‚îú‚îÄ‚îÄ FASTQC/                                      # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ <SAMPLE>_fastqc.html                    # (Reporte calidad cruda)
‚îú‚îÄ‚îÄ TRIMMED_READS/                               # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ <SAMPLE>.trimmed.fastq.gz               # (Lecturas limpias tras Trimmomatic)
‚îú‚îÄ‚îÄ ALIGNMENTS_<STAR|HISAT2>/                    # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ <SAMPLE>_Aligned.sortedByCoord.out.bam   # (Archivo BAM final)
‚îú‚îÄ‚îÄ STRINGTIE_<STAR|HISAT2>/                     # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ <SAMPLE>/gene_abundances.tsv            # (C√°lculo intermedio TPM/FPKM)
‚îÇ
‚îú‚îÄ‚îÄ COUNTS/                                      # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îú‚îÄ‚îÄ counts_<ALIGNER>.txt                    # (Matriz conteos crudos - featureCounts)
‚îÇ   ‚îú‚îÄ‚îÄ counts_STAR.txt/counts_HISAT2.txt        # (Matrices duales si se activa el modo "both")
‚îÇ   ‚îú‚îÄ‚îÄ <ALIGNER>_TPM_matrix.tsv                # (Matriz normalizada TPM - StringTie)
‚îÇ   ‚îî‚îÄ‚îÄ <ALIGNER>_FPKM_matrix.tsv               # (Matriz normalizada FPKM - StringTie)
‚îÇ
‚îú‚îÄ‚îÄ EDA_RESULTS_<ALIGNER>_<TYPE>/                # [Gen: 01_EDA_QC.R]
‚îÇ   ‚îú‚îÄ‚îÄ 1_Distribution_Check.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 2_Variance_Structure.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 3_PCA_Analysis.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 4_Dendrogram.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 5_Sample_Correlation.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 6_Top_Variable_Genes.pdf
‚îÇ   ‚îî‚îÄ‚îÄ 7_QC_Report_Automated.txt                # (Informe de QC con sospechas de outliers)
‚îÇ
‚îú‚îÄ‚îÄ DESEQ2_RESULTS_<ALIGNER>/                    # [Gen: Scripts R 02, 03 y 04]
‚îÇ   ‚îú‚îÄ‚îÄ metadata_corregido.csv                   # [01_pipeline_core -> pasa a R]
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   # --- Salidas de 02_Differential_expression.R ---
‚îÇ   ‚îú‚îÄ‚îÄ QC_estadisticas_conteos_crudos_*.txt
‚îÇ   ‚îú‚îÄ‚îÄ Resultados_Completos_<CONTRASTE>.txt     # (Tabla maestra con stats)
‚îÇ   ‚îú‚îÄ‚îÄ Resultados_Significativos_<CONTRASTE>.txt
‚îÇ   ‚îú‚îÄ‚îÄ genes_huerfanos_<CONTRASTE>.txt          # (Genes significativos sin GO/KEGG)
‚îÇ   ‚îú‚îÄ‚îÄ VolcanoPlot_Dashboard_<CONTRASTE>.html   # (Interactivo Plotly)
‚îÇ   ‚îú‚îÄ‚îÄ Analisis_Rutas_Enriquecidas_*.txt        # (Input para scripts visuales)
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   # --- Salidas de 03_Functional_analysis_viz.R ---
‚îÇ   ‚îú‚îÄ‚îÄ Informe_Interactivo_<CONTRASTE>.html     # (Dashboard global funcional)
‚îÇ   ‚îú‚îÄ‚îÄ Informe_Completo_Ontogenia_*.txt         # (Resumen texto plano)
‚îÇ   ‚îú‚îÄ‚îÄ sea_analysis_plots/                      # (Plots ORA/SEA: Dotplots, Cnetplots)
‚îÇ   ‚îú‚îÄ‚îÄ gsea_analysis_plots/                     # (Plots GSEA: Ridgeplots, GSEA curves)
‚îÇ   ‚îú‚îÄ‚îÄ pathview_plots/                          # (Mapas de rutas KEGG coloreados .png/.pdf)
‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   # --- Salida de 04_Comprehensive_Report_Builder.R ---
‚îÇ   ‚îî‚îÄ‚îÄ Informe_Transcriptomica_Completo_*.pdf   # (Reporte Final Paginado)
‚îÇ
‚îú‚îÄ‚îÄ MULTIQC_<ALIGNER>_REPORT/                    # [Gen: 01_pipeline_core.py]
‚îÇ   ‚îî‚îÄ‚îÄ multiqc_report.html                      # (Auditor√≠a de calidad unificada)
‚îÇ
‚îî‚îÄ‚îÄ WORKFLOW_COMPARISON/                         # [Gen: 01_pipeline_core.py - Solo modo "both"]
    ‚îî‚îÄ‚îÄ resumen_comparacion_genes.txt            # (Estad√≠sticas de intersecci√≥n STAR vs HISAT2)
Descripci√≥n del Flujo de Datos:El pipeline comienza con la fase de ingenier√≠a de datos orquestada por Python usando main.py y este ejecutado por RNA_SEQ_LETS_TRY.sh. Los scripts experiment_profiler.py y data_conector.py generan la carpeta Info_<PRJ> con los metadatos y la lista de descargas. A continuaci√≥n, el motor principal 01_pipeline_core.py se encarga del trabajo pesado: descarga y descomprime las referencias (REFERENCE_GENOMES) y los datos crudos (FASTQ_FILES), ejecuta el control de calidad y limpieza (FASTQC, TRIMMED_READS), realiza el alineamiento (ALIGNMENTS_<STAR/HISAT2>) y la cuantificaci√≥n (STRINGTIE, COUNTS), produciendo las matrices de conteo .txt y .tsv que servir√°n de entrada para la estad√≠stica. En ejecuciones con validaci√≥n cruzada (modo both), el pipeline genera sets de resultados independientes para cada alineador, permitiendo al investigador elegir el motor con mayor tasa de mapeo.Una vez generadas las matrices, entran en acci√≥n los m√≥dulos de R. El script 01_EDA_QC.R toma la matriz de conteos y genera la carpeta EDA_RESULTS, que contiene diagn√≥sticos visuales (PCA, Heatmaps) y el reporte de outliers. Posteriormente, 02_Differential_expression.R crea la carpeta principal DESEQ2_RESULTS, donde deposita las tablas de expresi√≥n diferencial, los genes hu√©rfanos y el Volcano Plot interactivo. Sobre esa misma carpeta, 03_Functional_analysis_viz.R a√±ade las subcarpetas de visualizaci√≥n (sea/gsea/pathview_plots) y el dashboard HTML funcional. Finalmente, 04_Comprehensive_Report_Builder.R recopila toda esta informaci√≥n para compilar el Informe_Transcriptomica_Completo.pdf usando gProfiler. Como broche final, Python vuelve a intervenir para generar el reporte de MULTIQC, que unifica las m√©tricas de calidad de todas las herramientas (FastQC, Trimmomatic, STAR, HISAT2 y featureCounts), permitiendo al investigador validar la robustez t√©cnica de la ejecuci√≥n y justificar estad√≠sticamente cualquier decisi√≥n de exclusi√≥n de muestras antes de la interpretaci√≥n biol√≥gica.v 9. Autor√≠a, Impacto y Colaboraci√≥nOmniRNA-seq nace con la filosof√≠a del c√≥digo abierto (licencia MIT) para eliminar barreras en la ciencia, pero su arquitectura robusta es el resultado de cientos de horas de ingenier√≠a y la dedicaci√≥n de un Investigador Predoctoral (FPU).COLABORACIONES LOCALES: Para an√°lisis de datos privados (FASTQs o matrices.csv), contacta conmigo:üÜî ORCID: 0000-0003-0207-9026üìß Contacto: sergio120897@gmail.comFacilita tus FASTQs o matriz.csv + metadata.csv y recibir√°s tus resultados pronto.Tu reconocimiento es el verdadero motor de este proyecto. Si este pipeline agiliza tu investigaci√≥n, una cita en tu paper es la mejor forma de validarlo y apoyar mi carrera acad√©mica.Adem√°s, la ciencia es mejor cuando se comparte: si necesitas una integraci√≥n profunda, auditor√≠a de datos o soporte bioinform√°tico experto para elevar el impacto de tu estudio, estoy totalmente abierto a la colaboraci√≥n y co-autor√≠a.¬°Transformemos juntos esos datos crudos en descubrimientos biol√≥gicos!üë®‚Äçüíª Sergio Garc√≠a D√≠az | Lead Developer & FPU Fellow
